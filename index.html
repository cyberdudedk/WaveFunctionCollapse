<html>
    <head>
        <script>var exports = {};</script>
        <style>
            table tr td:nth-child(2n-1) {
                width: 15%;

            }
            table tr td:nth-child(2n) {
                width: 10%;
                padding-right: 10px;
            }

            table input, table select {
                width: 100%;
            }

            table input[type="checkbox"] {
                width: auto;
            }
        </style>
        <script type="module" src="/dist/bundle.js"></script>
        <script>
             
            var wfc = {};
            var config = {
                    
            };
        function applyConfig() {
            const queryParams = new URLSearchParams(window.location.search);
            for(var configItem in config) {
                var element = document.getElementById(configItem);
                
                if(element.type == 'checkbox') {
                    queryParams.set(configItem, element.checked ? 1 : 0);
                }
                else if(configItem == "tileName" || configItem == "set") {
                    var value = element.value;
                    queryParams.set(configItem, value);
                } else {
                    var value = parseInt(element.value);
                    var min = parseInt(element.min);
                    var max = parseInt(element.max);
                    if(element.min && value < min) {
                        value = min;
                    }
                    if(element.max && value > max) {
                        
                        value = max;
                    }
                    queryParams.set(configItem, value);
                }
            }
            document.location = "?" + queryParams.toString();
        }

        function loadConfig() {
            const queryParams = new URLSearchParams(window.location.search);
            config.tileName = queryParams.get('tileName') ?? 'Knots';
            config.set = queryParams.get('set') ?? 'all';
            config.maxRetryCount = parseInt((queryParams.get('maxRetryCount') ?? 10));
            config.maxDepth =  parseInt((queryParams.get('maxDepth') ?? 100));
            config.tileScale =  parseInt((queryParams.get('tileScale') ?? 30));
            config.fast = parseInt((queryParams.get('fast') ?? 0));
            config.runSpeed = parseInt((queryParams.get('runSpeed') ?? 10));
            config.runLoop = parseInt((queryParams.get('runLoop') ?? 30));
            config.tilesHeight = parseInt((queryParams.get('tilesHeight') ?? 15));
            config.tilesWidth = parseInt((queryParams.get('tilesWidth') ?? 15));
            config.superImposed = parseInt((queryParams.get('superImposed') ?? 1));
            config.useMouse = parseInt((queryParams.get('useMouse') ?? 0));
        }

        function loadConfigControls(config) {
            var tiles = wfc.getAvailableTiles();
            var tileSelector = document.getElementById("tileName");
            for (var tileIndex in tiles){
                var tile = tiles[tileIndex];
                var opt = document.createElement('option');
                opt.value = tile;
                opt.innerHTML = tile;
                tileSelector.appendChild(opt);
            }

            var superImposedStates = wfc.getSuperImposedStates();
            var superImposedSelector = document.getElementById("superImposed");
            for (var superimposedIndex in superImposedStates){
                var isValueProperty = Number(superimposedIndex) >= 0;
                if (isValueProperty) {
                    var superImposed = superImposedStates[superimposedIndex];
                    var opt = document.createElement('option');
                    opt.value = superimposedIndex;
                    opt.innerHTML = superImposed;
                    superImposedSelector.appendChild(opt);
                }
            }
            
            for(var configItem in config) {
                let type = document.getElementById(configItem).type;
                if(type == 'checkbox') {
                    let val = config[configItem];
                    document.getElementById(configItem).checked = val;
                } else {
                    document.getElementById(configItem).value = config[configItem];
                }
                
            }

            selectTile(document.getElementById('tileName'));
            document.getElementById('set').value = config['set'];
            
        }

        function selectTile(obj) {
            var sets = wfc.getAvailableSets(obj.value);
            var setSelector = document.getElementById("set");
            while (setSelector.options.length) setSelector.remove(0);
            for (var setIndex in sets){
                var set = sets[setIndex];
                var opt = document.createElement('option');
                opt.value = set;
                opt.innerHTML = set;
                setSelector.appendChild(opt);
            }
        }

        window.addEventListener("load", async function(){
                loadConfig();
                wfc = getWFC('draw');
                wfc.init(config);
                loadConfigControls(config);

                await wfc.initTileData();
                wfc.initDraw();
            });

        </script>
    </head>
    <body style="background-color: rgba(249, 249, 249, 0.84);">
        <div>
            <h3>Controlpanel</h3>
            <div>
                <table>
                    <tbody>
                        <tr>
                            <td>tileName</td><td><select id="tileName" onchange="selectTile(this)"></select></td>
                            <td>set</td><td><select value="all" id="set"></select></td>
                            <td>superImposed</td><td><select id="superImposed"></select></td>
                        </tr>
                        <tr>
                            <td>tilesHeight</td><td><input type="number" min="0" max="200" id="tilesHeight"></td>
                            <td>tilesWidth</td><td><input type="number" min="0" max="200" id="tilesWidth"></td>
                            <td>tileScale</td><td><input type="number" min="1" max="200" id="tileScale"></td>
                        </tr>
                        <tr>
                            <td>runSpeed</td><td><input type="number" min="1" max="5000" id="runSpeed"></td>
                            <td>runLoop</td><td><input type="number" min="1" max="1000" id="runLoop"></td>
                            <td>fast</td><td><input type="checkbox" id="fast" value="fast"></td>
                        </tr>
                        <tr>
                            <td>maxRetryCount</td><td><input type="number" min="0" max="100" id="maxRetryCount"></td>
                            <td>maxDepth</td><td><input type="number" min="1" max="500" id="maxDepth"></td>
                            <td>useMouse</td><td><input type="checkbox" id="useMouse" value="useMouse"></td>
                        </tr>
                        <tr>
                            <td><button id="apply" onclick="applyConfig()" >Apply</button></td><td></td>
                            <td></td><td></td>
                            <td></td><td></td>
                            
                        </tr>
                    </tbody>
                </table>
                
                
                
                
                
                
                

                
            </div>
        </div>
        <br>
        <canvas id="draw">

        </canvas>
    </body>
</html>